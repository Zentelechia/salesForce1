
<template name="layout">
	{{loginButtons}}

	<table id="layout">
		<tr>
			<td>
				{{> header}}
				{{> history}}
			</td>
			<td rowspan="3">
				{{> calendar}}
			</td>
		</tr>
		<tr>	
			<td>
				{{> tools}}
			</td>
		</tr>
		
		<tr>
			<td colspan="2">
				{{yield 'sayBefore'}}
				{{> say}}
				{{yield 'sayAfter'}}
			</td>
		</tr>
		<tr>
			<td>
				{{yield 'tags'}}
			</td>
		</tr>
		<tr>
			<td colspan="2">
				{{yield 'dataBefore'}}
				{{yield}}
				{{yield 'dataAfter'}}
			</td>
		</tr>
	</table>
	<img id="target" style="display: none" src="../target.gif"/>
</template>

<template name="phrases">
	<div id="phrases">
		{{#each phrase}}
		{{{daySplitter added}}}
		<div id="{{_id}}">{{addedText}}
			{{#if client_name}}
			<a href="../client/{{clientID}}">
				{{client_name}}
			</a>: 
			{{/if}}
			<span>{{name}}</span>	
			{{#each tags}}
			<span class="tag">{{this}}</span>
			{{/each}}
		</div>
		{{/each}}
	</div>
</template>

<template name="clients">
	<input id="clients"/>
	<div class="clients">
		{{#each client}}
		<div id="{{_id}}">{{workName}}</div><span>{{stage}}</span>
		{{/each}}
	</div>
</template>

<template name="globalSearch">
	{{#each client}}
	<span id="{{_id}}">{{workName}}</span>
	{{/each}}
	{{#each contact}}
	<span id='{{this._id}}'>{{name}}</span>
	{{/each}}
	{{#each phrase}}
	<span id='{{this._id}}'>{{name}}</span>
	{{/each}}
</template>


<template name="history">
	{{#each list}}
		{{this}}
	{{/each}}
</template>
<template name="fileUpload">
	<div class="fileupload fileupload-new" data-provides="fileupload">
		<span class="btn btn-file">
			<span class="fileupload-new">{{file-upload.label.de}}</span>
			<span class="fileupload-exists">Andere</span>
			<input name="{{file-upload.name}}" class="file-upload-input" method="{{file-upload.method}}" type="file"/>
		</span>
		<span class="fileupload-preview">
		</span>
		<a href="#" class="close fileupload-exists" data-dismiss="fileupload" style="float: none">×</a>
	</div>
</template>
<template name="client">
	<div class="clientCard">
		<div id="fields">
		{{#each fields}}
		<span>{{caption}}</span><span sys="{{sys}}" contenteditable>{{{clientProperty sys}}}</span><br>
		{{/each}}
		</div>
		{{> clientContacts}}
	</div>
</template>

<template name="tags">
	<div id="tags"><img id="colorpick" src="../colors.png"/>
		{{#each tags}}
		<span {{#if color}} style="background-color: {{color}}"{{/if}}}{{{isTagSelected name}}} unselectable="on">{{name}}</span>{{/each}}<div contenteditable id="addTag"></div>
	</div>
</template>

<template name="sessions">
	<div>Session: {{info}}</div>
</template>

<template name="say">
	<textarea {{{searchMode}}} id="say"/>
	<textarea id="todo"/>
</template>
<template name="loadingTemplate">
	<img id="loading" src="../loading.gif"/>
</template>
<template name="tools">
	<div id="tools">
		<a href="{{pathFor 'home'}}"><img selectStart=1 selectEnd=1 alt="Поиск" text="" src="../home.png"/></a>
		<img id="search" selectStart=1 selectEnd=1 alt="Поиск" text="" src="../search.png"/>
		<a href="{{pathFor 'clients'}}"><img id="clientsIcon" src="../clients.png"/></a>
		<a href="{{pathFor 'contacts'}}"><img id="contactsIcon" src="../contacts.png"/></a>		
		<img selectStart=30 selectEnd=34 alt="Звонок" text="Осуществлен #звонок# клиенту #.....# на тему:. Результат:" src="../call.png"/>
		<img selectStart=27 selectEnd=31 alt="Встреча" text="Была #встреча# с клиентом #....#. Тема встречи:....... Задачи" src="../meeting.png"/>
		<img selectStart=1 selectEnd=5 alt="Презентация" text="Выполнена #презентация# клиенту #....#. В ходе презентации выявлены следующие потребности....... Дальнейшие действия......." src="../presentation.png"/>
		<img selectStart=1 selectEnd=8 alt="Заметка" text="#Заметка# по клиенту #....# "src="../notes.png"/>
		<img selectStart=12 selectEnd=17 alt="Напомнить" text="#Напомнить# когда о " src="../remind.png"/>
		<img selectStart=1 selectEnd=9 alt="Делегировать" text="#Поручить# задачу" src="../delegate.png"/>

		<img selectStart=1 selectEnd=1 alt="В корзину" text="" src="../attachment.png"/>
		<img id="bin" selectStart=1 selectEnd=1 alt="В корзину" text="" src="../bin.png"/>
		<img id="books" selectStart=1 selectEnd=1 alt="В корзину" text="" src="../thisMonth.png"/>
		<img id="enter" selectStart=1 selectEnd=1 alt="В корзину" text="" src="../enter.png"/>
	</div>
</template>
<template name="calendar">
	<div id="calendar">
		{{#each cells}}
		<div data="{{this.date}}" class="{{this.month}} cell" count={{this.c}}>
			<div class="plan" style="height: {{this.plan}}%"></div>
			<div class="fact" style="height: {{this.fact}}%; opacity: {{this.result}}"></div>
			<div class="day">{{this.day}}</div>
		</div>
		{{/each}}
	</div>
</template>


<template name="clientContacts">
	<table id="contacts">
		<thead>
			{{#each fields}}
			<th>{{this.caption}}</th>
			{{/each}}
		</thead>
		{{#each contact}}
		<tr id='{{this._id}}'>
			{{#each fields}}
			<td contenteditable >{{{getKey ../this this.sys}}}</td>
			{{/each}}
			<tr>
				{{/each}}
			</table>
		</template>


		<template name="contacts">
			<table id="myContacts">
				<thead>
					<th>Клиент</th>
					{{#each fields}}
					<th>{{this.caption}}</th>
					{{/each}}
				</thead>
				{{#each contact}}
				<tr id='{{this._id}}'>
					<td><a href="/client/{{this.client_id}}">{{this.client_name}}</a></td>
					{{#each fields}}
					<td contenteditable >{{{getKey ../this this.sys}}}</td>
					{{/each}}
					<tr>
						{{/each}}
					</table>

				</template>

				<template name="contact">
				</template>

				<template name="header">
					<h2>{{where}}</h2>
				</template>